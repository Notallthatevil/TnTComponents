@page "/externalclick"
@using NTComponents
@using NTComponents.Core
@rendermode InteractiveAuto

<h3>External Click Handler Demo</h3>

<p>Click inside the colored box or outside to see the effect.</p>

<TnTExternalClickHandler ExternalClickCallback="HandleExternalClick">
	<div style="width: 300px; height: 150px; background-color: var(--tnt-color-primary-container); display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 8px; border: 2px solid var(--tnt-color-outline);">
		<span style="color: var(--tnt-color-on-primary-container); font-weight: bold;">External Click Handler</span>
		<span style="color: var(--tnt-color-on-primary-container); font-size: 0.8rem;">(Clicks outside trigger callback)</span>

		<TnTButton>
			Button
		</TnTButton>
	</div>
</TnTExternalClickHandler>

<div style="margin-top: 20px; padding: 15px; border-radius: 8px; background-color: var(--tnt-color-surface-container-high); border: 1px solid var(--tnt-color-outline-variant); min-height: 60px; max-width: 400px;">
	<strong>Last Event:</strong>
	<span style="display: block; margin-top: 5px; color: var(--tnt-color-primary);">@Message</span>
</div>

<div style="margin-top: 40px;">
	<h4>How it works</h4>
	<ul>
		<li>The <code>TnTExternalClickHandler</code> component wraps its children.</li>
		<li>It uses JS interop to detect <code>mousedown</code> and <code>click</code> events.</li>
		<li>If a click occurs outside the boundaries of the handler, the <code>ExternalClickCallback</code> is invoked.</li>
		<li>The latest version uses position-based detection to handle cases where elements might be removed from the DOM during the click event.</li>
	</ul>
</div>

@code {
	private string Message { get; set; } = "Waiting for clicks...";
	private int Counter { get; set; } = 0;

	private void HandleExternalClick() {
		Counter++;
		Message = $"External click #{Counter} detected at {DateTime.Now:HH:mm:ss}";
		StateHasChanged();
	}
}
