@page "/typeahead-form-test"
@using TnTComponents
@inject IJSRuntime JS
@rendermode @(new InteractiveServerRenderMode(false))

<h3>Typeahead Form Submission Test</h3>

<TnTForm Model="_model" OnSubmit="@OnFormSubmitAsync">
    <div class="form-section">
        <h4>Regular Text Input (Control Test)</h4>
        <p>This input should allow form submission on Enter</p>
        <input type="text" placeholder="Enter text" class="form-input" />
    </div>

    <div class="form-section">
        <h4>Typeahead Input</h4>
        <p>Form submission should be prevented when selecting items with Enter</p>
        <TnTTypeahead 
            @bind-Value="_searchValue" 
            ItemsLookupFunc="SearchFunc" 
            Label="Search items"
            ItemSelectedCallback="@(new EventCallback<string>(this, OnItemSelected))" />
    </div>

    <button type="submit" class="form-submit-btn">Submit Form</button>
</TnTForm>

@if (_formSubmitted) {
    <div class="success-message">Form was submitted successfully</div>
}

@if (_selectedItem != null) {
    <div class="selected-item">Selected item: @_selectedItem</div>
}

@code {
    private FormModel _model = new();
    private string? _searchValue;
    private string? _selectedItem;
    private bool _formSubmitted;

    private async Task<IEnumerable<string>> SearchFunc(string? searchValue, CancellationToken cancellationToken)
    {
        var items = new[]
        {
            "Apple", "Banana", "Cherry", "Date", "Elderberry",
            "Fig", "Grape", "Honeydew", "Kiwi", "Lemon"
        };

        if (string.IsNullOrWhiteSpace(searchValue))
            return [];

        return items.Where(item => 
            item.Contains(searchValue, StringComparison.OrdinalIgnoreCase));
    }

    private void OnItemSelected(string item)
    {
        _selectedItem = item;
        // Log to console for E2E test detection
        _ = JS.InvokeVoidAsync("console.log", $"Item selected: {item}");
    }

    private async Task OnFormSubmitAsync(EditContext context)
    {
        _formSubmitted = true;
        // Log to console for E2E test detection
        await JS.InvokeVoidAsync("console.log", "Form submitted");
    }

    private class FormModel
    {
        // Simple model for the form
    }
}

<style>
    .form-section {
        margin-bottom: 2rem;
        padding: 1rem;
        border: 1px solid #ccc;
        border-radius: 4px;
    }

    .form-input {
        width: 100%;
        padding: 0.5rem;
        margin: 0.5rem 0;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 1rem;
    }

    .form-submit-btn {
        padding: 0.75rem 1.5rem;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 1rem;
        margin-top: 1rem;
    }

    .form-submit-btn:hover {
        background-color: #0056b3;
    }

    .success-message {
        margin-top: 1rem;
        padding: 1rem;
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
        border-radius: 4px;
    }

    .selected-item {
        margin-top: 1rem;
        padding: 1rem;
        background-color: #e2e3e5;
        color: #383d41;
        border: 1px solid #d6d8db;
        border-radius: 4px;
    }
</style>
