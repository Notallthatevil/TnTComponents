@namespace NTComponents
@inherits TnTComponentBase
@using Microsoft.AspNetCore.Components.Web
@using NTComponents.Core
@typeparam TObjectType

<CascadingValue Value="this" IsFixed="true">
	@ChildContent
	<DeferRendering>
		<div @attributes="AdditionalAttributes"
			 class="@ElementClass"
			 style="@ElementStyle"
			 id="@ElementId"
			 role="group"
			 aria-label="@AriaLabel">

			@foreach (var item in _items) {
				@if (string.IsNullOrEmpty(item.Label) && item.StartIcon is not null && item.EndIcon is null) {
					<TnTImageButton class="@($"btn-group-btn{(IsSelectedItem(item) ? " btn-group-selected" : null)}")"
									Appearance="@Appearance"
									BackgroundColor="@GetItemBackgroundColor(item)"
									TextColor="@GetItemTextColor(item)"
									TintColor="@GetItemTintColor(item)"
									OnTintColor="@GetItemOnTintColor(item)"
									ButtonSize="@ButtonSize"
									Shape="@GetItemShape(item)"
									StopPropagation="@StopPropagation"
									Disabled="@IsButtonDisabled(item)"
									EnableRipple="@EnableRipple"
									Icon="@item.StartIcon"
									OnClickCallback="@(() => HandleItemClickAsync(item))" />
				}
				else {
					<TnTButton class="@($"btn-group-btn{(IsSelectedItem(item) ? " btn-group-selected" : null)}")"
							   Appearance="@Appearance"
							   BackgroundColor="@GetItemBackgroundColor(item)"
							   TextColor="@GetItemTextColor(item)"
							   TintColor="@GetItemTintColor(item)"
							   OnTintColor="@GetItemOnTintColor(item)"
							   ButtonSize="@ButtonSize"
							   Shape="@GetItemShape(item)"
							   StopPropagation="@StopPropagation"
							   Disabled="@IsButtonDisabled(item)"
							   EnableRipple="@EnableRipple"
							   OnClickCallback="@(() => HandleItemClickAsync(item))">
						@if (item.StartIcon is not null) {
							@item.StartIcon.Render()
						}
						<span>@item.Label</span>
						@if (item.EndIcon is not null) {
							@item.EndIcon.Render()
						}
					</TnTButton>
				}
			}
		</div>
		@if (EditContext is not null) {
			@if (!string.IsNullOrWhiteSpace(_name)) {
				<input type="hidden" name="@_name" value="@SelectedKey" />
			}
			<div class="tnt-supporting-text" style="@CssStyleBuilder.Create().AddForegroundColor(TextColor).Build()">
				<ValidationMessage class="tnt-supporting-text tnt-validation-message" For="SelectedKeyExpression" style="@CssStyleBuilder.Create().AddForegroundColor(ErrorColor).Build()"/>
			</div>
		}
	</DeferRendering>
</CascadingValue>