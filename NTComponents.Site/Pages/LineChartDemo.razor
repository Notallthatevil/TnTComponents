@page "/line-chart"
@using NTComponents.Charts
@using NTComponents.Charts.Core
@using NTComponents.Charts.Core.Axes
@using NTComponents.Charts.Core.Series

<div class="container py-4">
	<h1>Line Chart Demo</h1>
	<p class="lead">Examples and configurations for the new declarative NTLineSeries component.</p>

	<div class="row mb-4">
		<div class="col-12">
			<div class="card p-3 shadow-sm">
				<h5>Global Settings</h5>
				<div class="form-check form-switch">
					<input class="form-check-input" type="checkbox" @bind="_enableHardwareAcceleration"
						   id="hwAccelCheck">
					<label class="form-check-label" for="hwAccelCheck">Enable Hardware Acceleration for Charts</label>
				</div>
			</div>
		</div>
	</div>

	<div class="row mt-4">
		<div class="col-md-6 mb-4">
			<div class="card p-3 shadow-sm">
				<h3>Basic Line Chart</h3>
				<div style="height: 300px;">
					<NTChart TData="CartesianPoint" Title="Basic Data" IsCategoricalX="true"
							 EnableHardwareAcceleration="@_enableHardwareAcceleration">
						<NTLineSeries TData="CartesianPoint" Data="@_basicData" Title="My data"
									  XValue="@(p => p.X)" YValueSelector="@(p => p.Y)" Color="TnTColor.Primary"
									  PointStyle="PointStyle.Filled" PointSize="10" />
					</NTChart>
				</div>
			</div>
		</div>

		<div class="col-md-6 mb-4">
			<div class="card p-3 shadow-sm">
				<h3>Multiple Series (Auto Shapes)</h3>
				<div style="height: 300px;">
					<NTChart TData="CartesianPoint" Title="Comparison" Palette="@_customPalette" IsCategoricalX="true"
							 EnableHardwareAcceleration="@_enableHardwareAcceleration">
						<NTLineSeries TData="CartesianPoint" Data="@_productA" XValue="@(p => p.X)"
									  YValueSelector="@(p => p.Y)" PointStyle="PointStyle.Filled"
									  XAxis="@sharedXAxis" YAxis="@yAxis1" />
						<NTLineSeries TData="CartesianPoint" Data="@_productB" XValue="@(p => p.X)"
									  YValueSelector="@(p => p.Y)" PointStyle="PointStyle.Outlined"
									  XAxis="@sharedXAxis" YAxis="@yAxis2" />

					</NTChart>
				</div>
			</div>
		</div>
	</div>

	<div class="row mt-4">
		<div class="col-md-6 mb-4">
			<div class="card p-3 shadow-sm">
				<h3>Custom Point Shapes</h3>
				<div style="height: 300px;">
					<NTChart TData="CartesianPoint" Title="Customized"
							 EnableHardwareAcceleration="@_enableHardwareAcceleration">
						<NTLineSeries TData="CartesianPoint" Data="@_customData" XValue="@(p => p.X)"
									  YValueSelector="@(p => p.Y)" Color="TnTColor.Error" StrokeWidth="5"
									  PointStyle="PointStyle.Filled" PointShape="PointShape.Diamond" PointSize="12"
									  XAxis="@(new NTXAxisOptions { Title = "Sequence" })"
									  YAxis="@(new NTYAxisOptions { Title = "Value" })" />
					</NTChart>
				</div>
				<div class="mt-2 text-muted">
					Custom Stroke Width (5), Diamond Shape, and Large Points.
				</div>
			</div>
		</div>

		<div class="col-md-6 mb-4">
			<div class="card p-3 shadow-sm">
				<h3>Mathematical Functions</h3>
				<div style="height: 300px;">
					<NTChart TData="CartesianPoint" Title="Sine Wave"
							 EnableHardwareAcceleration="@_enableHardwareAcceleration">
						<NTLineSeries TData="CartesianPoint" Data="@_animatedData" XValue="@(p => p.X)"
									  YValueSelector="@(p => p.Y)" Color="TnTColor.Success"
									  XAxis="@(new NTXAxisOptions { Title = "Radians" })"
									  YAxis="@(new NTYAxisOptions { Title = "Amplitude" })" />
					</NTChart>
				</div>
			</div>
		</div>
	</div>

	<div class="row mt-4">
		<div class="col-md-6 mb-4">
			<div class="card p-3 shadow-sm">
				<h3>Interpolation Modes</h3>
				<div style="height: 300px;">
					<NTChart TData="CartesianPoint" Title="Curved vs Step"
							 EnableHardwareAcceleration="@_enableHardwareAcceleration">
						<NTLineSeries TData="CartesianPoint" Data="@_basicData" XValue="@(p => p.X)"
									  YValueSelector="@(p => p.Y)" Color="TnTColor.Primary"
									  Interpolation="LineInterpolation.Curved" Title="Curved"  />
						<NTLineSeries TData="CartesianPoint" Data="@_basicData" XValue="@(p => p.X)"
									  YValueSelector="@(p => p.Y)" Color="TnTColor.Warning" Interpolation="LineInterpolation.Step"
									  Title="Step" />
					</NTChart>
				</div>
				<div class="mt-2 text-muted">
					Showing Curved (Blue) and Step (Yellow) interpolation.
				</div>
			</div>
		</div>

		<div class="col-md-6 mb-4">
			<div class="card p-3 shadow-sm">
				<h3>Dashed & Scatter Styles</h3>
				<div style="height: 300px;">
					<NTChart TData="CartesianPoint" Title="Styles"
							 EnableHardwareAcceleration="@_enableHardwareAcceleration">
						<NTLineSeries TData="CartesianPoint" Data="@_basicData" XValue="@(p => p.X)"
									  YValueSelector="@(p => p.Y)" Color="TnTColor.Secondary" LineStyle="LineStyle.Dashed"
									  Interpolation="LineInterpolation.Smoothed" />
						<NTLineSeries TData="CartesianPoint" Data="@_productB" XValue="@(p => p.X)"
									  YValueSelector="@(p => p.Y)" Color="TnTColor.Error" LineStyle="LineStyle.None"
									  PointStyle="PointStyle.Filled" PointShape="PointShape.Circle" />
					</NTChart>
				</div>
				<div class="mt-2 text-muted">
					Dashed with Smoothed corners (Purple) and Scatter mode (Red points, no line).
				</div>
			</div>
		</div>
	</div>

	<div class="row mt-4">
		<div class="col-12 mb-4">
			<div class="card p-3 shadow-sm">
				<h3>Custom Axis Values</h3>
				<div style="height: 300px;">
					<NTChart TData="CartesianPoint" Title="Explicit Labels"
							 EnableHardwareAcceleration="@_enableHardwareAcceleration">
						<NTLineSeries TData="CartesianPoint" Data="@_basicData" XValue="@(p => p.X)"
									  YValueSelector="@(p => p.Y)" Color="TnTColor.Primary"
									  XAxis="@(new NTXAxisOptions { Title = "Selected X" })"
									  YAxis="@(new NTYAxisOptions { Title = "Major Y" })" />
					</NTChart>
				</div>
				<div class="mt-2 text-muted">
					Demonstrating explicit axis labels (0 to 100 on both axes).
				</div>
			</div>
		</div>
	</div>

	<div class="row mt-4">
		<div class="col-12 mb-4">
			<div class="card p-3 shadow-sm">
				<div class="d-flex justify-content-between align-items-center mb-2">
					<h3>Pan & Zoom</h3>
					<button class="btn btn-sm btn-outline-secondary" @onclick="() => interactiveChart.ResetView()">
						Reset
						View
					</button>
				</div>
				<div style="height: 800px;">
					<NTChart @ref="interactiveChart" TData="CartesianPoint" Title="Interactive Chart" EnablePan="true"
							 EnableZoom="true" EnableHardwareAcceleration="@_enableHardwareAcceleration">
						<NTLineSeries TData="CartesianPoint" Data="@_animatedData" XValue="@(p => p.X)"
									  YValueSelector="@(p => p.Y)" Color="TnTColor.Primary"
									  XAxis="@(new NTXAxisOptions { Title = "X Axis (Scroll to zoom, Drag to pan)" })"
									  YAxis="@(new NTYAxisOptions { Title = "Y Axis" })" />
					</NTChart>
				</div>
				<div class="mt-2 text-muted">
					Use mouse wheel to zoom (centered on mouse) and click-drag to pan.
				</div>
			</div>
		</div>
	</div>

	<div class="row mt-4">
		<div class="col-12 mb-4">
			<div class="card p-4 shadow-sm border-0 bg-white">
				<div class="d-flex justify-content-between align-items-center mb-3">
					<div>
						<h3 class="mb-0">Chart Sandbox</h3>
						<p class="text-muted small">Dynamic series management and property customization.</p>
					</div>
					<div class="btn-group shadow-sm">
						<button class="btn btn-outline-primary" @onclick="RandomizeSandbox"
								title="Randomize all series data">
							Randomize Data
						</button>
						<button class="btn btn-success" @onclick="AddSeries" disabled="@(_sandboxSeries.Count >= 10)">
							Add Series
						</button>
						<button class="btn btn-danger" @onclick="RemoveSeries" disabled="@(_sandboxSeries.Count <= 1)">
							Remove Series
						</button>
					</div>
				</div>

				<div class="row">
					<div class="col-lg-8">
						<div style="height: 500px;" class="border rounded bg-light p-2 shadow-inner">
							<NTChart TData="CartesianPoint" Title="Interactive Sandbox" RangePadding="0.1"
									 EnableHardwareAcceleration="@_enableHardwareAcceleration" Orientation="@_orientation">
								@if (_showLegend) {
									<NTLegend TData="CartesianPoint" Position="@_legendPosition" />
								}


								@foreach (var config in _sandboxSeries) {
									<NTLineSeries TData="CartesianPoint" Data="@config.Data" XValue="@(p => p.X)"
												  YValueSelector="@(p => p.Y)" Title="@config.Title"
												  Interpolation="@config.Interpolation" LineStyle="@config.LineStyle"
												  PointShape="@config.PointShape" PointStyle="@config.PointStyle"
												  ShowDataLabels="@config.ShowDataLabels" XAxis="@sandboxXAxis"
												  YAxis="@sandboxYAxis" />
								}
							</NTChart>
						</div>
					</div>
					<div class="col-lg-4">
						<div class="card mb-3 shadow-sm border-primary">
							<div class="card-body p-2">
								<h6 class="card-title">Global Chart Settings</h6>
								<div class="row g-2">
									<div class="col-6">
										<div class="form-check form-switch mt-2">
											<input class="form-check-input" type="checkbox" @bind="_showLegend"
												   id="showLegendCheck">
											<label class="form-check-label small" for="showLegendCheck">
												Show
												Legend
											</label>
										</div>
									</div>
									<div class="col-6">
										<label class="small text-muted fw-bold d-block">Legend Position</label>
										<select class="form-select form-select-sm" @bind="_legendPosition">
											@foreach (var val in Enum.GetValues<LegendPosition>()) {
												<option value="@val">@val</option>
											}
										</select>
									</div>
									<div class="col-12">
										<label class="small text-muted fw-bold d-block">Orientation</label>
										<select class="form-select form-select-sm" @bind="_orientation">
											@foreach (var val in Enum.GetValues<NTChartOrientation>()) {
												<option value="@val">@val</option>
											}
										</select>
									</div>
								</div>
							</div>
						</div>
						<div style="max-height: 400px; overflow-y: auto;" class="pe-2 custom-scrollbar">
							@for (int i = 0; i < _sandboxSeries.Count; i++) {
								var index = i;
								var config = _sandboxSeries[i];
								<div class="card mb-3 border-start border-4 @GetBorderClass(index) shadow-sm">
									<div class="card-body p-2">
										<h6 class="card-title d-flex justify-content-between align-items-center">
											<span>Series @(index + 1)</span>
											<span class="badge @GetBadgeClass(index)">Series @(index + 1) Color</span>
										</h6>
										<div class="row g-2">
											<div class="col-6">
												<label class="small text-muted fw-bold d-block">Interpolation</label>
												<select class="form-select form-select-sm" @bind="config.Interpolation">
													@foreach (var val in Enum.GetValues<LineInterpolation>()) {
														<option value="@val">@val</option>
													}
												</select>
											</div>
											<div class="col-6">
												<label class="small text-muted fw-bold d-block">Line Style</label>
												<select class="form-select form-select-sm" @bind="config.LineStyle">
													@foreach (var val in Enum.GetValues<LineStyle>()) {
														<option value="@val">@val</option>
													}
												</select>
											</div>
											<div class="col-6">
												<label class="small text-muted fw-bold d-block">Point Shape</label>
												<select class="form-select form-select-sm" @bind="config.PointShape">
													@foreach (var val in Enum.GetValues<PointShape>()) {
														<option value="@val">@val</option>
													}
												</select>
											</div>
											<div class="col-6">
												<label class="small text-muted fw-bold d-block">Point Style</label>
												<select class="form-select form-select-sm" @bind="config.PointStyle">
													@foreach (var val in Enum.GetValues<PointStyle>()) {
														<option value="@val">@val</option>
													}
												</select>
											</div>
											<div class="col-12 mt-2">
												<div class="form-check form-switch">
													<input class="form-check-input" type="checkbox"
														   @bind="config.ShowDataLabels" id="@($"labelCheck{index}")">
													<label class="form-check-label small" for="@($"labelCheck{index}")">
														Show
														Data Labels
													</label>
												</div>
											</div>
										</div>
									</div>
								</div>
							}
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="row mt-4">
		<div class="col-12 mb-4">
			<div class="card p-3 shadow-sm">
				<h3>Horizontal Trend (Swapped Axes)</h3>
				<div style="height: 300px;">
					<NTChart TData="CartesianPoint" Title="Horizontal Progress"
							 Orientation="NTChartOrientation.Horizontal"
							 EnableHardwareAcceleration="@_enableHardwareAcceleration">
						<NTLineSeries TData="CartesianPoint" Data="@_basicData" XValue="@(p => p.X)"
									  YValueSelector="@(p => p.Y)" Color="TnTColor.Info" PointStyle="PointStyle.Filled"
									  XAxis="@(new NTXAxisOptions { Title = "Independent (X)" })"
									  YAxis="@(new NTYAxisOptions { Title = "Dependent (Y)" })" />
					</NTChart>
				</div>
				<div class="mt-2 text-muted">
					Demonstrating a line chart in horizontal orientation. The independent variable (X) is on the
					vertical axis.
				</div>
			</div>
		</div>
	</div>
</div>

@code {
	private void OnConditionRender(NTDataPointRenderArgs<CartesianPoint> args) {
		if (args.Data.Y > 40m) {
			args.Color = SkiaSharp.SKColors.Orange;
			args.LineStyle = LineStyle.Dashed;
		}
	}
	private NTXAxisOptions sharedXAxis = new NTXAxisOptions();
	private NTYAxisOptions yAxis1 = new NTYAxisOptions { Title = "Revenue ($)" };
	private NTYAxisOptions yAxis2 = new NTYAxisOptions { Title = "Units Sold" };
	public record CartesianPoint(double X, decimal Y);

	private NTChart<CartesianPoint> interactiveChart = default!;

	private List<(TnTColor Background, TnTColor Text)> _customPalette = new() { (TnTColor.Tertiary, TnTColor.OnTertiary),
(TnTColor.Success, TnTColor.OnSuccess) };

	private List<CartesianPoint> _dynamicData = Enumerable.Range(1, 10).Select(i => new CartesianPoint(i,
	Random.Shared.Next(10, 90))).ToList();

	private void UpdateData() {
		int count = Random.Shared.Next(5, 20);
		_dynamicData = Enumerable.Range(1, count).Select(i => new CartesianPoint(i, Random.Shared.Next(10, 90))).ToList();
	}

	private List<CartesianPoint> _basicData = Enumerable.Range(1, 10)
	.Select(i => new CartesianPoint(i, (decimal)(i * 1.5 + Random.Shared.Next(0, 5))))
	.ToList();

	private List<CartesianPoint> _productA = [new(1, 10m), new(2, 25m), new(3, 15m), new(4, 30m), new(5, 45m)];
	private List<CartesianPoint> _productB = [new(1, 20m), new(2, 10m), new(3, 40m), new(4, 20m), new(5, 30m)];

	private List<CartesianPoint> _customData = [new(1, 20m), new(2, 20m), new(3, 40m), new(4, 40m), new(5, 60m), new(6, 60m)];

	private List<CartesianPoint> _animatedData = Enumerable.Range(0, 50)
	.Select(i => new CartesianPoint(i * 0.2, (decimal)(Math.Sin(i * 0.2) * 50 + 50)))
	.ToList();

	private bool _showLegend = true;
	private LegendPosition _legendPosition = LegendPosition.Bottom;
	private NTChartOrientation _orientation = NTChartOrientation.Vertical;
	private bool _enableHardwareAcceleration = true;

	// Sandbox Logic
	private List<SeriesSandboxConfig> _sandboxSeries = new();

	protected override void OnInitialized() {
		AddSeries(); // Start with one
	}

	private void AddSeries() {
		if (_sandboxSeries.Count >= 10)
			return;

		var config = new SeriesSandboxConfig {
			Title = $"Series {_sandboxSeries.Count + 1}",
			Interpolation = (LineInterpolation)(_sandboxSeries.Count % 4),
			Data = GenerateRandomData()
		};
		_sandboxSeries.Add(config);
	}

	private void RemoveSeries() {
		if (_sandboxSeries.Count > 1) {
			_sandboxSeries.RemoveAt(_sandboxSeries.Count - 1);
		}
	}

	private void RandomizeSandbox() {
		foreach (var s in _sandboxSeries) {
			s.Data = GenerateRandomData();
		}
	}

	private List<CartesianPoint> GenerateRandomData() {
		int count = Random.Shared.Next(5, 15);
		return Enumerable.Range(1, count)
		.Select(i => new CartesianPoint(i, (decimal)Random.Shared.Next(5, 95)))
		.ToList();
	}

	private string GetBorderClass(int index) => (index % 6) switch {
		0 => "border-primary",
		1 => "border-secondary",
		2 => "border-info",
		3 => "border-success",
		4 => "border-warning",
		_ => "border-danger"
	};

	private string GetBadgeClass(int index) => (index % 6) switch {
		0 => "bg-primary text-white",
		1 => "bg-secondary text-white",
		2 => "bg-info text-dark",
		3 => "bg-success text-white",
		4 => "bg-warning text-dark",
		_ => "bg-danger text-white"
	};

	public class SeriesSandboxConfig {
		public string Title { get; set; } = string.Empty;
		public List<CartesianPoint> Data { get; set; } = new();
		public LineInterpolation Interpolation { get; set; } = LineInterpolation.Straight;
		public LineStyle LineStyle { get; set; } = LineStyle.Solid;
		public PointShape PointShape { get; set; } = PointShape.Circle;
		public PointStyle PointStyle { get; set; } = PointStyle.Filled;
		public bool ShowDataLabels { get; set; }
	}
	private NTXAxisOptions sandboxXAxis = new NTXAxisOptions { Title = "Time" };
	private NTYAxisOptions sandboxYAxis = new NTYAxisOptions { Title = "Value" };
}
