@page "/line-chart"
@using NTComponents.Charts
@using NTComponents.Charts.Core
@using NTComponents.Charts.Core.Axes
@using NTComponents.Charts.Core.Series

<div class="container py-4">
    <h1>Line Chart Demo</h1>
    <p class="lead">Working examples for line series rendering, tooltips, axis behavior, and interactions.</p>

    <div class="row mb-4">
        <div class="col-12">
            <div class="card p-3 shadow-sm">
                <div class="d-flex gap-3 align-items-center flex-wrap">
                    <div class="form-check form-switch mb-0">
                        <input class="form-check-input" type="checkbox" @bind="_enableHardwareAcceleration" id="hwAccelCheck">
                        <label class="form-check-label" for="hwAccelCheck">Enable Hardware Acceleration</label>
                    </div>
                    <button class="btn btn-sm btn-outline-primary" @onclick="RegenerateData">Regenerate Data</button>
                    <button class="btn btn-sm btn-outline-secondary" @onclick="ResetInteractiveView">Reset Pan/Zoom</button>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4">
        <div class="col-lg-6">
            <div class="card p-3 shadow-sm h-100">
                <h5>Basic Line + Tooltip</h5>
                <div style="height: 320px;">
                    <NTChart TData="CartesianPoint" TitleOptions="@new("Basic Data")" EnableHardwareAcceleration="@_enableHardwareAcceleration" DebugView="true">
                        <NTXAxisOptions ValueSelector="@(p => p.X)" Title="Index" />
                        <NTYAxisOptions ValueSelector="@(p => p.Y)" Title="Value" />

                        <NTLineSeries TData="CartesianPoint"
                                      Data="@_basicData"
                                      Title="Series A"
                                      XValue="@(p => p.X)"
                                      YValueSelector="@(p => p.Y)"
                                      Color="TnTColor.Primary"
                                      PointStyle="PointStyle.Filled"
                                      PointSize="8" />

                        <NTTooltip />
                        <NTLegend />
                    </NTChart>
                </div>
            </div>
        </div>

        <div class="col-lg-6">
            <div class="card p-3 shadow-sm h-100">
                <h5>Comparison (Multiple Styles)</h5>
                <div style="height: 320px;">
                    <NTChart TData="CartesianPoint" TitleOptions="@new("Comparison")" EnableHardwareAcceleration="@_enableHardwareAcceleration" DebugView="true">
                        <NTXAxisOptions ValueSelector="@(p => p.X)" Title="Index" />
                        <NTYAxisOptions ValueSelector="@(p => p.Y)" Title="Value" />

                        <NTLineSeries TData="CartesianPoint"
                                      Data="@_seriesA"
                                      Title="Straight"
                                      XValue="@(p => p.X)"
                                      YValueSelector="@(p => p.Y)"
                                      Color="TnTColor.Primary"
                                      Interpolation="LineInterpolation.Straight"
                                      LineStyle="LineStyle.Solid"
                                      PointStyle="PointStyle.Filled" />

                        <NTLineSeries TData="CartesianPoint"
                                      Data="@_seriesB"
                                      Title="Smoothed Dashed"
                                      XValue="@(p => p.X)"
                                      YValueSelector="@(p => p.Y)"
                                      Color="TnTColor.Secondary"
                                      Interpolation="LineInterpolation.Smoothed"
                                      LineStyle="LineStyle.Dashed"
                                      PointStyle="PointStyle.Outlined"
                                      PointShape="PointShape.Diamond" />

                        <NTTooltip />
                        <NTLegend />
                    </NTChart>
                </div>
            </div>
        </div>

        <div class="col-lg-6">
            <div class="card p-3 shadow-sm h-100">
                <h5>DateTime X Axis</h5>
                <div style="height: 320px;">
                    <NTChart TData="TimePoint" TitleOptions="@new("Daily Trend")" EnableHardwareAcceleration="@_enableHardwareAcceleration" DebugView="true">
                        <NTXAxisOptions ValueSelector="@(p => p.Time)" Title="Date" />
                        <NTYAxisOptions ValueSelector="@(p => p.Value)" Title="Amount" LabelFormat="{0:N0}" />

                        <NTLineSeries TData="TimePoint"
                                      Data="@_timeSeries"
                                      Title="Daily"
                                      XValue="@(p => p.Time)"
                                      YValueSelector="@(p => p.Value)"
                                      Color="TnTColor.Tertiary"
                                      Interpolation="LineInterpolation.Curved"
                                      PointStyle="PointStyle.Filled"
                                      PointSize="6" />

                        <NTTooltip />
                        <NTLegend />
                    </NTChart>
                </div>
            </div>
        </div>

        <div class="col-lg-6">
            <div class="card p-3 shadow-sm h-100">
                <h5>Pan + Zoom (Interactive)</h5>
                <div style="height: 320px;">
                    <NTChart @ref="_interactiveChart" TData="CartesianPoint" TitleOptions="@new("Interactive")" EnableHardwareAcceleration="@_enableHardwareAcceleration" DebugView="true">
                        <NTXAxisOptions ValueSelector="@(p => p.X)" Title="X" />
                        <NTYAxisOptions ValueSelector="@(p => p.Y)" Title="Y" />

                        <NTLineSeries TData="CartesianPoint"
                                      Data="@_interactiveData"
                                      Title="Zoomable"
                                      XValue="@(p => p.X)"
                                      YValueSelector="@(p => p.Y)"
                                      Color="TnTColor.Success"
                                      Interactions="@(ChartInteractions.XPan | ChartInteractions.YPan | ChartInteractions.XZoom | ChartInteractions.YZoom)"
                                      PointStyle="PointStyle.None"
                                      StrokeWidth="2.5f" />

                        <NTTooltip />
                        <NTLegend />
                    </NTChart>
                </div>
                <small class="text-muted mt-2">Use mouse wheel to zoom and drag to pan.</small>
            </div>
        </div>
    </div>
</div>

@code {
    public record CartesianPoint(double X, decimal Y);
    public record TimePoint(DateTime Time, decimal Value);

    private NTChart<CartesianPoint>? _interactiveChart;
    private bool _enableHardwareAcceleration = true;

    private List<CartesianPoint> _basicData = [];
    private List<CartesianPoint> _seriesA = [];
    private List<CartesianPoint> _seriesB = [];
    private List<CartesianPoint> _interactiveData = [];
    private List<TimePoint> _timeSeries = [];

    protected override void OnInitialized() {
        RegenerateData();
    }

    private void RegenerateData() {
        _basicData = Enumerable.Range(1, 30)
            .Select(i => new CartesianPoint(i, (decimal)(12 + (Math.Sin(i * 0.25) * 8) + Random.Shared.NextDouble() * 3)))
            .ToList();

        _seriesA = Enumerable.Range(1, 40)
            .Select(i => new CartesianPoint(i, (decimal)(18 + (Math.Sin(i * 0.22) * 10) + (Math.Cos(i * 0.07) * 4))))
            .ToList();

        _seriesB = Enumerable.Range(1, 40)
            .Select(i => new CartesianPoint(i, (decimal)(16 + (Math.Cos(i * 0.18) * 9) + (Math.Sin(i * 0.05) * 3))))
            .ToList();

        _interactiveData = Enumerable.Range(0, 400)
            .Select(i => {
                var x = i * 0.5;
                var y = (decimal)((Math.Sin(x * 0.12) * 35) + (Math.Cos(x * 0.03) * 15) + 55);
                return new CartesianPoint(x, y);
            })
            .ToList();

        var start = DateTime.Today.AddDays(-29);
        _timeSeries = Enumerable.Range(0, 30)
            .Select(i => new TimePoint(start.AddDays(i), (decimal)(90 + (Math.Sin(i * 0.35) * 25) + Random.Shared.NextDouble() * 10)))
            .ToList();
    }

    private void ResetInteractiveView() {
        _interactiveChart?.ResetView();
    }
}
