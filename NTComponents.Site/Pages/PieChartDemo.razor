@page "/pie-chart"
@using NTComponents.Charts
@using NTComponents.Charts.Core
@using NTComponents.Charts.Core.Series

<div class="container py-4">
   <h1>Pie & Donut Chart Demo</h1>
   <p class="lead">Showcasing the new NTPieSeries with animation and interaction.</p>

   <div class="row mb-4">
      <div class="col-12">
         <div class="card p-3 shadow-sm">
            <h5>Global Settings</h5>
            <div class="form-check form-switch">
               <input class="form-check-input" type="checkbox" @bind="_enableHardwareAcceleration" id="hwAccelCheck">
               <label class="form-check-label" for="hwAccelCheck">Enable Hardware Acceleration</label>
            </div>
         </div>
      </div>
   </div>

   <div class="row mt-4">
      <div class="col-md-6 mb-4">
         <div class="card p-3 shadow-sm">
            <h3>Basic Pie Chart</h3>
            <div style="height: 400px;">
               <NTChart TData="SalesData" Title="Sales by Category"
                  EnableHardwareAcceleration="@_enableHardwareAcceleration">
                  <NTPieSeries TData="SalesData" Data="@_categorySales" ValueSelector="@(d => d.Amount)"
                     XValue="@(d => d.Category)" />
               </NTChart>
            </div>
            <div class="mt-2 text-muted small">
               Animates from 12 o'clock. Hover over segments to explode them.
            </div>
         </div>
      </div>

      <div class="col-md-6 mb-4">
         <div class="card p-3 shadow-sm">
            <h3>Donut Chart</h3>
            <div style="height: 400px;">
               <NTChart TData="SalesData" Title="Market Share"
                  EnableHardwareAcceleration="@_enableHardwareAcceleration">
                  <NTPieSeries TData="SalesData" Data="@_marketShare" ValueSelector="@(d => d.Amount)"
                     XValue="@(d => d.Category)" InnerRadiusRatio="0.6f" />
               </NTChart>
            </div>
            <div class="mt-2 text-muted small">
               Using <code>InnerRadiusRatio="0.6f"</code> to create a donut appearance.
            </div>
         </div>
      </div>
   </div>

   <div class="row mt-4">
      <div class="col-12 mb-4">
         <div class="card p-4 shadow-sm">
            <div class="d-flex justify-content-between align-items-center mb-3">
               <div>
                  <h3 class="mb-0">Pie Sandbox</h3>
                  <p class="text-muted small">Fine-tune appearance and data dynamically.</p>
               </div>
               <div class="btn-group">
                  <button class="btn btn-outline-primary" @onclick="RandomizeData">Randomize Data</button>
                  <button class="btn btn-outline-secondary" @onclick="ToggleLegend">Toggle Legend</button>
               </div>
            </div>

            <div class="row">
               <div class="col-lg-8">
                   <div style="height: 500px;" class="border rounded bg-light p-2">
                      <NTChart TData="SalesData" Title="Interactive Sandbox"
                         EnableHardwareAcceleration="@_enableHardwareAcceleration">
                         @if (_showLegend)
                         {
                             <NTLegend TData="SalesData" Position="@_legendPosition" />
                         }
                         <NTPieSeries TData="SalesData" Data="@_sandboxData" ValueSelector="@(d => d.Amount)"
                            XValue="@(d => d.Category)" InnerRadiusRatio="@_innerRadius"
                            ExplosionDistance="@_explosionDistance" ExplosionOnEntry="@_explosionOnEntry" />
                      </NTChart>
                   </div>
               </div>
               <div class="col-lg-4">
                  <div class="card shadow-sm border-info">
                     <div class="card-body">
                        <h6 class="fw-bold">Sandbox Controls</h6>

                        <div class="mb-3">
                           <label class="form-label small">Inner Radius Ratio (@_innerRadius.ToString("P0"))</label>
                           <input type="range" class="form-range" min="0" max="0.9" step="0.1" @bind="_innerRadius"
                              @bind:event="oninput">
                        </div>

                        <div class="mb-3">
                           <label class="form-label small">Explosion Distance (@_explosionDistance)</label>
                           <input type="range" class="form-range" min="0" max="50" step="5" @bind="_explosionDistance"
                              @bind:event="oninput">
                        </div>

                        <div class="mb-3 form-check form-switch pt-2">
                           <input class="form-check-input" type="checkbox" @bind="_explosionOnEntry"
                              id="entryExplosionCheck">
                           <label class="form-check-label small" for="entryExplosionCheck">Animate Entry
                              Explosion</label>
                        </div>

                        <div class="mb-3">
                           <label class="form-label small">Legend Position</label>
                           <select class="form-select form-select-sm" @bind="_legendPosition">
                              @foreach (var val in Enum.GetValues<LegendPosition>())
                              {
                                 <option value="@val">@val</option>
                              }
                           </select>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>
   </div>
</div>

@code {
   public record SalesData(string Category, decimal Amount);

   private bool _enableHardwareAcceleration = true;
   private bool _showLegend = true;
   private LegendPosition _legendPosition = LegendPosition.Right;
   private float _innerRadius = 0.5f;
   private float _explosionDistance = 15f;
   private bool _explosionOnEntry = true;

   private List<SalesData> _categorySales = new()
{
new("Electronics", 12500m),
new("Clothing", 8400m),
new("Home & Kitchen", 7200m),
new("Books", 3100m),
new("Toys", 2500m)
};

   private List<SalesData> _marketShare = new()
{
new("Company A", 45m),
new("Company B", 25m),
new("Company C", 15m),
new("Others", 15m)
};

   private List<SalesData> _sandboxData = new();

   protected override void OnInitialized()
   {
      RandomizeData();
   }

   private void RandomizeData()
   {
      var cats = new[] { "Apples", "Oranges", "Bananas", "Grapes", "Melons", "Berries", "Peaches" };
      _sandboxData = cats.Select(c => new SalesData(c, Random.Shared.Next(10, 100))).ToList();
   }

   private void ToggleLegend() => _showLegend = !_showLegend;
}
