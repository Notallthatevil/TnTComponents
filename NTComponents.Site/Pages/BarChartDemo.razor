@page "/bar-chart"
@using NTComponents.Charts
@using NTComponents.Charts.Core
@using NTComponents.Charts.Core.Axes
@using NTComponents.Charts.Core.Series

<div class="container py-4">
   <h1>Bar Chart Demo</h1>
   <p class="lead">Examples and configurations for the new declarative NTBarSeries component.</p>

   <div class="row mb-4">
      <div class="col-12">
         <div class="card p-3 shadow-sm">
            <h5>Global Settings</h5>
            <div class="form-check form-switch">
               <input class="form-check-input" type="checkbox" @bind="_enableHardwareAcceleration" id="hwAccelCheck">
               <label class="form-check-label" for="hwAccelCheck">Enable Hardware Acceleration for Charts</label>
            </div>
         </div>
      </div>
   </div>

   <div class="row mt-4">
      <div class="col-md-6 mb-4">
         <div class="card p-3 shadow-sm">
            <h3>Basic Bar Chart</h3>
            <div style="height: 300px;">
               <NTChart TData="CartesianPoint" Title="Revenue"
                  EnableHardwareAcceleration="@_enableHardwareAcceleration">
                  <NTBarSeries TData="CartesianPoint" Data="@_basicData" XValue="@(p => p.X)"

                     YValueSelector="@(p => p.Y)" Color="TnTColor.Primary"
                     XAxis="@(new NTXAxisOptions { Title = "Month" })"
                     YAxis="@(new NTYAxisOptions { Title = "Total ($)" })" />
               </NTChart>
            </div>
         </div>
      </div>

      <div class="col-md-6 mb-4">
         <div class="card p-3 shadow-sm">
            <h3>Rounded Corners</h3>
            <div style="height: 300px;">
               <NTChart TData="CartesianPoint" Title="Rounded Bars"
                  EnableHardwareAcceleration="@_enableHardwareAcceleration">
                  <NTBarSeries TData="CartesianPoint" Data="@_productA" XValue="@(p => p.X)"

                     YValueSelector="@(p => p.Y)" Color="TnTColor.Secondary" CornerRadius="8"
                     XAxis="@(new NTXAxisOptions())" YAxis="@(new NTYAxisOptions())" />
               </NTChart>
            </div>
            <div class="mt-2 text-muted">
               Bars with a 8px corner radius.
            </div>
         </div>
      </div>
   </div>

   <div class="row mt-4">
      <div class="col-md-6 mb-4">
         <div class="card p-3 shadow-sm">
            <h3>Side-by-Side Bars</h3>
            <div style="height: 300px;">
               <NTChart TData="CartesianPoint" Title="Multi-Series"
                  EnableHardwareAcceleration="@_enableHardwareAcceleration">
                  @{
                     var sharedXAxis = new NTXAxisOptions();

                     var sharedYAxis = new NTYAxisOptions();
                  }
                  <NTBarSeries TData="CartesianPoint" Data="@_basicData" XValue="@(p => p.X)"
                     YValueSelector="@(p => p.Y)" Color="TnTColor.Primary" XAxis="@sharedXAxis"
                     YAxis="@sharedYAxis" />
                  <NTBarSeries TData="CartesianPoint" Data="@_customData" XValue="@(p => p.X)"
                     YValueSelector="@(p => p.Y)" Color="TnTColor.Secondary" XAxis="@sharedXAxis"
                     YAxis="@sharedYAxis" />
               </NTChart>
            </div>
            <div class="mt-2 text-muted">
               Multiple bar series lay out side-by-side within each category with no gaps between them.
            </div>
         </div>
      </div>

      <div class="col-md-6 mb-4">
         <div class="card p-3 shadow-sm">
            <h3>Data Labels</h3>
            <div style="height: 300px;">
               <NTChart TData="CartesianPoint" Title="Stats" RangePadding="0.1"
                  EnableHardwareAcceleration="@_enableHardwareAcceleration">
                  <NTBarSeries TData="CartesianPoint" Data="@_basicData" XValue="@(p => p.X)"

                     YValueSelector="@(p => p.Y)" Color="TnTColor.Info" ShowDataLabels="true"
                     XAxis="@(new NTXAxisOptions())" YAxis="@(new NTYAxisOptions())" />
               </NTChart>
            </div>
         </div>
      </div>
   </div>

   <div class="row mt-4">
      <div class="col-md-6 mb-4">
         <div class="card p-3 shadow-sm">
            <h3>Conditional Styling</h3>
            <div style="height: 300px;">
               <NTChart TData="CartesianPoint" Title="Health Status"
                  EnableHardwareAcceleration="@_enableHardwareAcceleration">
                  <NTBarSeries TData="CartesianPoint" Data="@_basicData" XValue="@(p => p.X)"

                     YValueSelector="@(p => p.Y)" OnDataPointRender="@OnConditionRender" XAxis="@(new NTXAxisOptions())"
                     YAxis="@(new NTYAxisOptions())" />
               </NTChart>
            </div>
            <div class="mt-2 text-muted">
               Bars color based on value: <span style="color:red">Red</span> if &lt;= 20, else <span
                  style="color:green">Green</span>.
            </div>
         </div>
      </div>
   </div>

   <div class="row mt-4">
       <div class="col-md-6 mb-4">
          <div class="card p-3 shadow-sm">
             <h3>Horizontal Bars</h3>
              <div style="height: 300px;">
                 <NTChart TData="CartesianPoint" Title="Horizontal View"
                    EnableHardwareAcceleration="@_enableHardwareAcceleration">
                    <NTBarSeries TData="CartesianPoint" Data="@_basicData" XValue="@(p => p.X)"

                       YValueSelector="@(p => p.Y)" Color="TnTColor.Tertiary"
                       Orientation="NTChartOrientation.Horizontal"
                       XAxis="@(new NTXAxisOptions { Title = "Units Sold" })"
                       YAxis="@(new NTYAxisOptions { Title = "Categories" })" />
                 </NTChart>
              </div>

            <div class="mt-2 text-muted">
               Orientation set to Horizontal. Categories are on the Y-axis.
            </div>
         </div>
      </div>
   </div>

   <div class="row mt-4">
      <div class="col-12 mb-4">
         <div class="card p-4 shadow-sm border-0 bg-white">
            <div class="d-flex justify-content-between align-items-center mb-3">
               <div>
                  <h3 class="mb-0">Bar Sandbox</h3>
                  <p class="text-muted small">Dynamic bar management and styling.</p>
               </div>
               <div class="btn-group shadow-sm">
                  <button class="btn btn-outline-primary" @onclick="RandomizeSandbox">
                     Randomize Data
                  </button>
                  <button class="btn btn-success" @onclick="AddSeries" disabled="@(_sandboxSeries.Count >= 5)">
                     Add Series
                  </button>
                  <button class="btn btn-danger" @onclick="RemoveSeries" disabled="@(_sandboxSeries.Count <= 1)">
                     Remove Series
                  </button>
               </div>
            </div>

            <div class="row">
                <div class="col-lg-8">
                   <div style="height: 500px;" class="border rounded bg-light p-2 shadow-inner">
                      <NTChart TData="CartesianPoint" Title="Interactive Bar Sandbox" RangePadding="0.1"
                         EnableHardwareAcceleration="@_enableHardwareAcceleration">
                         @if (_showLegend)
                         {


                            <NTLegend TData="CartesianPoint" Position="@_legendPosition"
                               BackgroundColor="@_legendBgColor" />
                         }
                         @{
                            var sandboxXAxis = new NTXAxisOptions { Title = "Category" };
                            var sandboxYAxis = new NTYAxisOptions { Title = "Value" };
                         }
                         @foreach (var config in _sandboxSeries)
                         {
                            <NTBarSeries TData="CartesianPoint" Data="@config.Data" XValue="@(p => p.X)"
                               YValueSelector="@(p => p.Y)" Title="@config.Title" CornerRadius="@config.CornerRadius"
                               ShowDataLabels="@config.ShowDataLabels" XAxis="@sandboxXAxis" YAxis="@sandboxYAxis"
                               Orientation="@_orientation" />
                         }
                     </NTChart>
                  </div>
               </div>
               <div class="col-lg-4">
                  <div class="card mb-3 shadow-sm border-primary">
                     <div class="card-body p-2">
                        <h6 class="card-title">Global Chart Settings</h6>
                        <div class="row g-2">
                           <div class="col-6">
                              <div class="form-check form-switch mt-2">
                                 <input class="form-check-input" type="checkbox" @bind="_showLegend"
                                    id="showLegendCheck">
                                 <label class="form-check-label small" for="showLegendCheck">Show Legend</label>
                              </div>
                           </div>
                           <div class="col-6">
                              <label class="small text-muted fw-bold d-block">Legend Position</label>
                              <select class="form-select form-select-sm" @bind="_legendPosition">
                                 @foreach (var val in Enum.GetValues<LegendPosition>())
                                 {
                                    <option value="@val">@val</option>
                                 }
                              </select>
                           </div>
                           <div class="col-6">
                              <label class="small text-muted fw-bold d-block">Legend BG</label>
                              <select class="form-select form-select-sm" @bind="_legendBgColor">
                                 <option value="@TnTColor.None">Default</option>
                                 <option value="@TnTColor.Surface">Surface</option>
                                 <option value="@TnTColor.SurfaceContainer">Surface Container</option>
                                 <option value="@TnTColor.TertiaryContainer">Tertiary Container</option>
                              </select>
                           </div>
                           <div class="col-6">
                              <label class="small text-muted fw-bold d-block">Orientation</label>
                              <select class="form-select form-select-sm" @bind="_orientation">
                                 @foreach (var val in Enum.GetValues<NTChartOrientation>())
                                 {
                                    <option value="@val">@val</option>
                                 }
                              </select>
                           </div>
                        </div>
                     </div>
                  </div>
                  <div style="max-height: 400px; overflow-y: auto;" class="pe-2 custom-scrollbar">
                     @for (int i = 0; i < _sandboxSeries.Count; i++)
                     {
                        var index = i;
                        var config = _sandboxSeries[i];
                        <div class="card mb-3 border-start border-4 @GetBorderClass(index) shadow-sm">
                           <div class="card-body p-2">
                              <h6 class="card-title d-flex justify-content-between align-items-center">
                                 <span>Series @(index + 1)</span>
                                 <button class="btn btn-sm btn-outline-secondary"
                                    @onclick="() => config.Data = GenerateRandomData()">Regen</button>
                              </h6>
                              <div class="row g-2">
                                 <div class="col-6">
                                    <label class="small text-muted fw-bold d-block">Corner Radius</label>
                                    <input type="number" class="form-control form-control-sm"
                                       @bind="config.CornerRadius" />
                                 </div>
                                 <div class="col-6">
                                    <div class="form-check form-switch mt-4">
                                       <input class="form-check-input" type="checkbox" @bind="config.ShowDataLabels"
                                          id="@($"labelCheck{index}")">
                                       <label class="form-check-label small" for="@($"labelCheck{index}")">Show
                                          Targets</label>
                                    </div>
                                 </div>
                              </div>
                           </div>
                        </div>
                     }
                  </div>
               </div>
            </div>
         </div>
      </div>
   </div>
</div>

@code {
    private void OnConditionRender(NTDataPointRenderArgs<CartesianPoint> args)
    {
       args.Color = args.Data.Y <= 20m ? SkiaSharp.SKColors.Red : SkiaSharp.SKColors.Green;
    }

    public record CartesianPoint(double X, decimal Y);

    private List<CartesianPoint> _basicData = Enumerable.Range(1, 10)
    .Select(i => new CartesianPoint(i, (decimal)(20 + Random.Shared.Next(0, 50))))
    .ToList();

    private List<CartesianPoint> _productA = [new(1, 10m), new(2, 25m), new(3, 15m), new(4, 30m), new(5, 45m)];
    private List<CartesianPoint> _customData = [new(1, 40m), new(2, 60m), new(3, 30m), new(4, 80m), new(5, 50m)];

   private bool _showLegend = true;
   private LegendPosition _legendPosition = LegendPosition.Bottom;
   private TnTColor _legendBgColor = TnTColor.None;
   private NTChartOrientation _orientation = NTChartOrientation.Vertical;
   private bool _enableHardwareAcceleration = true;

   private List<BarSandboxConfig> _sandboxSeries = new();

   protected override void OnInitialized()
   {
      AddSeries();
   }

   private void AddSeries()
   {
      if (_sandboxSeries.Count >= 5) return;

      var config = new BarSandboxConfig
      {
         Title = $"Series {_sandboxSeries.Count + 1}",
         Data = GenerateRandomData()
      };
      _sandboxSeries.Add(config);
   }

   private void RemoveSeries()
   {
      if (_sandboxSeries.Count > 1)
      {
         _sandboxSeries.RemoveAt(_sandboxSeries.Count - 1);
      }
   }

   private void RandomizeSandbox()
   {
      foreach (var s in _sandboxSeries)
      {
         s.Data = GenerateRandomData();
      }
   }

    private List<CartesianPoint> GenerateRandomData()
    {
       int count = 8;
       return Enumerable.Range(1, count)
       .Select(i => new CartesianPoint(i, (decimal)Random.Shared.Next(10, 100)))
       .ToList();
    }

   private string GetBorderClass(int index) => (index % 6) switch
   {
      0 => "border-primary",
      1 => "border-secondary",
      2 => "border-info",
      3 => "border-success",
      4 => "border-warning",
      _ => "border-danger"
   };

   public class BarSandboxConfig
   {
      public string Title { get; set; } = string.Empty;
      public List<CartesianPoint> Data { get; set; } = new();
      public float CornerRadius { get; set; } = 4.0f;
      public bool ShowDataLabels { get; set; }
   }
}
